<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>USDT Arbitrage Checker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f7f7f7;
    }
    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 15px;
        background: white;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: center;
    }
    th {
        background: #eee;
    }
    input {
        padding: 5px;
        margin: 5px 0;
    }
    .profit {
        background: #c6f6c6;
    }
    .loss {
        background: #f6c6c6;
    }
</style>
</head>
<body>

<h2>USDT Arbitrage Checker</h2>

<label>Jumlah USDT: 
    <input id="usdt" type="number" value="100">
</label><br>
<label>Fee direct (%): 
    <input id="feeDirect" type="number" value="0">
</label><br>
<label>Fee indirect (% per step): 
    <input id="feeIndirect" type="number" value="0">
</label><br>
<label>Interval update (detik): 
    <input id="interval" type="number" value="30">
</label><br>

<table id="ratesTable">
    <thead>
        <tr>
            <th>Path</th>
            <th>Rate 1</th>
            <th>Rate 2</th>
            <th>Hasil (IDR)</th>
            <th>Selisih (%)</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const currencies = [
    "IDR","USD","EUR","JPY","GBP","AUD","CAD","CHF",
    "CNY","HKD","NZD","SGD","KRW","THB","MYR","VND",
    "PHP","INR"
];

async function fetchRates(base) {
    const urls = [
        `https://open.er-api.com/v6/latest/${base}`,
        `https://api.exchangerate.host/latest?base=${base}`
    ];
    for (let url of urls) {
        try {
            const res = await fetch(url);
            if (!res.ok) continue;
            const data = await res.json();
            if (data.rates) return data.rates;
        } catch (e) { continue; }
    }
    return {};
}

async function fetchAllRates() {
    const usdRates = await fetchRates("USD");
    const idrRates = await fetchRates("IDR");
    return { usdRates, idrRates };
}

async function updateRates() {
    const amountUSDT  = parseFloat(document.getElementById('usdt').value) || 0;
    const feeDirect   = (parseFloat(document.getElementById('feeDirect').value) || 0) / 100;
    const feeIndirect = (parseFloat(document.getElementById('feeIndirect').value) || 0) / 100;

    const { usdRates, idrRates } = await fetchAllRates();
    const tbody = document.querySelector('#ratesTable tbody');
    tbody.innerHTML = "";

    // Direct USDT -> IDR
    const directRate = usdRates["IDR"] || null;
    const directIDR  = directRate ? amountUSDT * directRate * (1 - feeDirect) : null;

    tbody.innerHTML += `
        <tr>
            <td>USDT → IDR</td>
            <td>${directRate ? directRate.toFixed(4) : 'ERR'}</td>
            <td>-</td>
            <td>${directIDR ? directIDR.toLocaleString() : 'ERR'}</td>
            <td>-</td>
        </tr>
    `;

    // Indirect paths
    for (let cur of currencies) {
        if (cur === "USD" || cur === "IDR") continue;

        const rate1 = usdRates[cur] || null;                // USD -> CUR
        const rate2 = idrRates[cur] ? 1 / idrRates[cur] : null; // CUR -> IDR

        if (rate1 && rate2) {
            const received = amountUSDT * rate1 * (1 - feeIndirect) * rate2 * (1 - feeIndirect);
            const diff     = directIDR ? ((received - directIDR) / directIDR * 100) : 0;
            const rowClass = diff > 0 ? 'profit' : (diff < 0 ? 'loss' : '');

            tbody.innerHTML += `
                <tr class="${rowClass}">
                    <td>USDT → ${cur} → IDR</td>
                    <td>${rate1.toFixed(4)}</td>
                    <td>${rate2.toFixed(4)}</td>
                    <td>${received.toLocaleString()}</td>
                    <td>${diff.toFixed(2)}%</td>
                </tr>
            `;
        } else {
            tbody.innerHTML += `
                <tr>
                    <td>USDT → ${cur} → IDR</td>
                    <td>${rate1 ? rate1.toFixed(4) : 'ERR'}</td>
                    <td>${rate2 ? rate2.toFixed(4) : 'ERR'}</td>
                    <td>ERR</td>
                    <td>-</td>
                </tr>
            `;
        }
    }
}

let timer;
function startAutoUpdate() {
    clearInterval(timer);
    updateRates();
    const sec = parseInt(document.getElementById('interval').value) * 1000;
    timer = setInterval(updateRates, sec);
}

document.querySelectorAll('input').forEach(inp => 
    inp.addEventListener('change', startAutoUpdate)
);

startAutoUpdate();
</script>

</body>
</html>
